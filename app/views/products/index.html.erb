<div class="search-bar">
  <%= form_with url: search_products_path, method: :get, local: true do |f| %>
    <%= f.text_field :q, placeholder: "Search products by name or description...", value: @query, class: "search-input" %>
    <%= f.submit "Search", class: "btn btn-search" %>
  <% end %>
</div>

<h1>Our Products</h1>

<% if @query.present? %>
  <p class="search-result">Search results for: "<%= @query %>" (<%= @products.count %> found)</p>
<% end %>

<div class="products-grid">
  <% @products.each do |product| %>
    <div class="product-card">
      <%= link_to product_path(product), class: "product-link" do %>
        <div class="product-image">
          <img src="<%= product.image_url %>" alt="<%= product.name %>" />
        </div>
        <div class="product-info">
          <h3><%= product.name %></h3>
          <p class="product-description"><%= truncate(product.description, length: 100) %></p>
          <p class="product-price">$<%= number_with_precision(product.price, precision: 2) %></p>
          <p class="product-stock">
            <% if product.stock > 0 %>
              In Stock: <%= product.stock %>
            <% else %>
              Out of Stock
            <% end %>
          </p>
        </div>
      <% end %>
      <div class="product-actions">
        <% if product.stock > 0 %>
          <%= button_to "Add to Cart", add_to_cart_path(product), class: "btn btn-primary" %>
        <% else %>
          <button class="btn btn-disabled" disabled>Out of Stock</button>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<% if @products.empty? %>
  <p class="no-results">No products found.</p>
<% end %>
